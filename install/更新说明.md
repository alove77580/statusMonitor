# 通知配置更新说明

## 更新内容

本次更新为通知配置添加了企业微信群机器人webhook支持，并实现了与Bark通知的互斥选择功能。

## 数据库更新

在开始使用新功能之前，需要先更新数据库表结构。

### 方法一：使用PHP脚本（推荐）

在浏览器中访问：
```
http://your-domain/install/update_notification_config.php
```

或通过命令行执行：
```bash
php install/update_notification_config.php
```

### 方法二：手动执行SQL

执行 `install/update_notification_config.sql` 文件中的SQL语句。

**注意**：如果字段已存在，执行SQL会报错，这是正常的，可以忽略。

## 功能说明

### 通知方式选择

系统现在支持两种通知方式：

1. **Bark通知**：iOS推送服务，可以将网站状态变化推送到iPhone
2. **企业微信群机器人**：通过企业微信群机器人webhook发送通知到企业微信群

### 互斥逻辑

- 两种通知方式互斥，只能选择其中一种
- 选择Bark时，企业微信群机器人配置会被清空
- 选择企业微信群机器人时，Bark配置会被清空

### 使用方法

1. 登录管理后台
2. 进入"通知配置"页面
3. 选择通知方式（Bark 或 企业微信群机器人）
4. 根据选择的方式填写相应的配置信息：
   - **Bark**：填写Bark推送密钥
   - **企业微信群机器人**：填写Webhook地址
5. 勾选"启用通知"
6. 点击"保存配置"
7. 可以使用"测试通知"按钮测试配置是否正确

### 企业微信群机器人Webhook获取方法

1. 在企业微信群中添加群机器人
2. 获取机器人的Webhook地址（格式：`https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxxx`）
3. 将Webhook地址填入配置页面

## 技术细节

- 数据库新增字段：
  - `wechat_work_webhook`：企业微信群机器人webhook地址
  - `notification_type`：通知类型（'bark' 或 'wechat_work'）

- 新增函数：
  - `sendWechatWorkNotification()`：发送企业微信群机器人通知

- 修改的文件：
  - `admin/notification.php`：通知配置页面
  - `admin/test_notification.php`：测试通知功能
  - `cron/check_sites.php`：监控脚本
  - `includes/functions.php`：核心函数库

